(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{600:function(v,_,o){v.exports=o.p+"assets/img/tfo.1deec214.jpg"},658:function(v,_,o){"use strict";o.r(_);var e=o(11),t=Object(e.a)({},(function(){var v=this,_=v.$createElement,e=v._self._c||_;return e("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[e("p",[v._v("前面讲到了 TCP 三次握手，可能有人会说，每次都三次握手好麻烦呀！能不能优化一点？")]),v._v(" "),e("p",[e("code",[v._v("TCP 快速打开(TCP Fast Open, 即TFO)")]),v._v(": 就是利用前面 SYN Flood 攻击时提到的 SYN Cookie。")]),v._v(" "),e("h2",{attrs:{id:"tfo-流程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tfo-流程"}},[v._v("#")]),v._v(" TFO 流程")]),v._v(" "),e("p",[e("strong",[v._v("首轮三次握手")])]),v._v(" "),e("p",[v._v("首先客户端发送 "),e("code",[v._v("SYN")]),v._v(" 给服务端，服务端接收到。")]),v._v(" "),e("p",[v._v("注意哦！现在服务端不是立刻回复 SYN + ACK，而是通过计算得到一个 "),e("code",[v._v("SYN Cookie")]),v._v(", 将这个 "),e("code",[v._v("Cookie")]),v._v(" 放到 TCP 报文的 "),e("code",[v._v("Fast Open")]),v._v(" 选项中，然后才给客户端返回。")]),v._v(" "),e("p",[v._v("客户端拿到这个 "),e("code",[v._v("Cookie")]),v._v(" 的值缓存下来。后面正常完成三次握手。")]),v._v(" "),e("p",[v._v("首轮三次握手就是这样的流程。而后面的三次握手就不一样啦！")]),v._v(" "),e("p",[e("strong",[v._v("后面的三次握手")])]),v._v(" "),e("p",[v._v("在后面的三次握手中，客户端会将之前缓存的 "),e("code",[v._v("Cookie")]),v._v("、"),e("code",[v._v("SYN")]),v._v(" 和 "),e("code",[v._v("HTTP请求")]),v._v(" (是的，你没看错)发送给服务端，服务端验证了 "),e("code",[v._v("Cookie")]),v._v(" 的合法性，如果不合法直接丢弃；如果是合法的，那么就正常返回"),e("code",[v._v("SYN + ACK")]),v._v("。")]),v._v(" "),e("p",[v._v("重点来了，现在服务端能向客户端发 HTTP 响应了！这是最显著的改变，三次握手还没建立，仅仅验证了 "),e("code",[v._v("Cookie")]),v._v(" 的合法性，就可以返回 HTTP 响应了。")]),v._v(" "),e("p",[v._v("当然，客户端的 "),e("code",[v._v("ACK")]),v._v(" 还得正常传过来，不然怎么叫三次握手嘛。")]),v._v(" "),e("p",[v._v("流程如下:")]),v._v(" "),e("p",[e("img",{attrs:{src:o(600),alt:"tfo"}})]),v._v(" "),e("p",[v._v("注意: 客户端最后握手的 ACK 不一定要等到服务端的 HTTP 响应到达才发送，两个过程没有任何关系。")]),v._v(" "),e("h2",{attrs:{id:"tfo-的优势"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tfo-的优势"}},[v._v("#")]),v._v(" TFO 的优势")]),v._v(" "),e("p",[v._v("TFO 的优势并不在与首轮三次握手，而在于后面的握手，在拿到客户端的 "),e("code",[v._v("Cookie")]),v._v(" 并验证通过以后，可以直接返回 HTTP 响应，充分利用了 "),e("strong",[v._v("1 个 RTT")]),v._v("T(Round-Trip Time，往返时延)的时间提前进行数据传输，积累起来还是一个比较大的优势。")])])}),[],!1,null,null,null);_.default=t.exports}}]);