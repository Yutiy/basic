(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{663:function(t,s,a){"use strict";a.r(s);var e=a(11),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("XSS(Cross-Site-Scripting, 跨站脚本攻击)是一种代码注入攻击。攻击者在目标网站上注入恶意代码，当被攻击者登录网站时就会执行这些恶意代码，比如读取 cookie、session tokens，或者其他敏感的网站信息，对用户进行钓鱼欺诈，甚至发起蠕虫攻击等。其本质是:")]),t._v(" "),a("ul",[a("li",[t._v("恶意代码未经过过滤，与网站正常代码混在一起")]),t._v(" "),a("li",[t._v("浏览器无法分辨那些脚本是可信的，导致恶意脚本被执行")]),t._v(" "),a("li",[t._v("直接在用户终端执行，其可以直接获取用户的信息，利用这些信息冒充用户向网站发起攻击")])]),t._v(" "),a("h2",{attrs:{id:"反射型-xss"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#反射型-xss"}},[t._v("#")]),t._v(" 反射型 XSS")]),t._v(" "),a("p",[t._v("当用户点击一个恶意链接，或者提交一个表单，或者进入一个恶意网站时，注入脚本进入被攻击者的网站。Web 服务器将注入脚本，比如一个错误信息，搜索结果等，未进行过滤直接返回到用户浏览器上。")]),t._v(" "),a("blockquote",[a("p",[t._v("反射型 XSS 攻击步骤:")])]),t._v(" "),a("ol",[a("li",[t._v("攻击者构造出特殊的 "),a("code",[t._v("URL")]),t._v("，其中包含恶意代码")]),t._v(" "),a("li",[t._v("用户打开带有恶意代码 "),a("code",[t._v("URL")]),t._v(" 时，网站服务端将恶意代码从 "),a("code",[t._v("URL")]),t._v(" 中取出，拼接在 HTML 中返回给浏览器")]),t._v(" "),a("li",[t._v("用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行")]),t._v(" "),a("li",[t._v("恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户行为，调用目标网站接口执行攻击者指定的操作")])]),t._v(" "),a("p",[t._v("反射型 XSS 漏洞常见于通过 "),a("code",[t._v("URL")]),t._v(" 传递参数的功能，如网站搜索、跳转等。由于需要用户主动打开恶意 "),a("code",[t._v("URL")]),t._v(" 才能生效，攻击者往往会结合多种手段诱导用户点击。")]),t._v(" "),a("p",[t._v("POST 的内容也可以触发反射型 XSS，只不过其触发条件比较苛刻（需要构造表单提交页面，并引导用户点击），所以非常少见。")]),t._v(" "),a("blockquote",[a("p",[t._v("如何防范反射型 XSS 攻击:")])]),t._v(" "),a("ul",[a("li",[t._v("不希望前端拿到 cookie，后端可以设置"),a("code",[t._v("httpOnly")]),t._v("（不过不是 XSS 攻击的解决方案，只能降低受损范围）")]),t._v(" "),a("li",[t._v("对字符串进行编码，如查询参数进行转义后再输出到页面")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/welcome'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodeURIComponent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("h2",{attrs:{id:"存储型-xss"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#存储型-xss"}},[t._v("#")]),t._v(" 存储型 XSS")]),t._v(" "),a("p",[t._v("恶意脚本永久存储在目标服务器上。存储型 XSS 的攻击步骤:")]),t._v(" "),a("ol",[a("li",[t._v("攻击者将恶意代码提交到目标网站的数据库中")]),t._v(" "),a("li",[t._v("用户打开目标网站时，网站服务端将恶意代码从数据库取出，凭借在 HTML 中返回给浏览器")]),t._v(" "),a("li",[t._v("用户浏览器接收到相应后解析执行，混在其中的恶意代码也被执行")]),t._v(" "),a("li",[t._v("恶意代码窃取用户数据并发送到攻击者网站，或者冒充用户行为，调用目标网站接口执行攻击者指定的操作")])]),t._v(" "),a("p",[t._v("这种攻击常见于带有用户保存数据的网站功能，如论坛发帖、商品评论、用户私信等。")]),t._v(" "),a("blockquote",[a("p",[t._v("如何防范存储型 XSS 攻击")])]),t._v(" "),a("ol",[a("li",[t._v("前端数据传递给服务器之前，先转义/过滤(防范不了抓包修改数据的情况)")]),t._v(" "),a("li",[t._v("服务端接收到数据，在存储到数据库之前，进行转义/过滤")]),t._v(" "),a("li",[t._v("前端接收到服务端传递过来的数据，在展示到页面前，先进行转义/过滤")])]),t._v(" "),a("h2",{attrs:{id:"dom-型-xss"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dom-型-xss"}},[t._v("#")]),t._v(" DOM 型 XSS")]),t._v(" "),a("p",[t._v("DOM 型 XSS 攻击，实际上是前端 JS 代码不够严谨，把不可信的内容插入到页面。在使用"),a("code",[t._v(".innerHTML")]),t._v("、"),a("code",[t._v(".outHTML")]),t._v("、"),a("code",[t._v(".appendChild")]),t._v("、"),a("code",[t._v("document.write()")]),t._v("等 API 时要注意，不可把不可信的数据作为 HTML 插入到页面上。尽量使用"),a("code",[t._v(".innerText")]),t._v("、"),a("code",[t._v(".textContent")]),t._v("、"),a("code",[t._v(".setAttribute()")]),t._v("等。")]),t._v(" "),a("blockquote",[a("p",[t._v("DOM 型 XSS 的攻击步骤")])]),t._v(" "),a("ul",[a("li",[t._v("攻击者构造出特殊数据，其中包含恶意代码")]),t._v(" "),a("li",[t._v("用户浏览器执行了恶意代码")]),t._v(" "),a("li",[t._v("恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户行为，调用目标网站接口执行攻击者指定的操作")])]),t._v(" "),a("blockquote",[a("p",[t._v("如何方法 DOM 型 XSS 攻击")])]),t._v(" "),a("p",[t._v("防范 DOM 型 XSS 攻击的核心就是对输入内容进行转义(DOM 中的内联事件监听器和链接跳转都能把字符串作为代码执行，需要对其内容进行检查)。")]),t._v(" "),a("ul",[a("li",[t._v("对于"),a("code",[t._v("url")]),t._v("链接，可以直接使用"),a("code",[t._v("encodeURIComponent")]),t._v("转义")]),t._v(" "),a("li",[t._v("对于非"),a("code",[t._v("url")]),t._v("，可以进行如下编码:")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodeHtml")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" str\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v('"')]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-flags"}},[t._v("g")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'&quot;'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("'")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-flags"}},[t._v("g")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'&apos;'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-flags"}},[t._v("g")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'&lt;'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-flags"}},[t._v("g")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'&gt;'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[a("strong",[t._v("除了谨慎的转义，还需要其他一些手段来防范 XSS 攻击:")])]),t._v(" "),a("ol",[a("li",[t._v("Content Security Policy")])]),t._v(" "),a("p",[t._v("在服务端使用 HTTP 的 "),a("code",[t._v("Content Security Policy")]),t._v(" 头部来指定策略，或者在前端设置 "),a("code",[t._v("meta")]),t._v(" 标签。例如下面的配置只允许加载同域下的资源:")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("Content-Security-Policy: default-src "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'self'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# meta 无法 report")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("meta http-equiv"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Security-Policy"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"form-action 'self';\"")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[t._v("严格的 CSP 在 XSS 的防范中可以起到一下作用：")]),t._v(" "),a("ul",[a("li",[t._v("禁止加载外域代码，防止复杂的攻击逻辑")]),t._v(" "),a("li",[t._v("禁止外域提交，网站被攻击后，用户的数据不会泄露到外域")]),t._v(" "),a("li",[t._v("禁止内联脚本执行（规则较严格，目前发现 GitHub 使用）")]),t._v(" "),a("li",[t._v("合理使用上报可以及时发现 XSS，利于尽快修复问题")]),t._v(" "),a("li",[t._v("禁止未授权的脚本执行（新特性，Google Map 移动版在使用）")])]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("输入内容长度控制")])]),t._v(" "),a("p",[t._v("对于不受信任的输入，都应该限定一个合理的长度。虽然无法完全防止 XSS 发生，但可以增加 XSS 攻击的难度")]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("输入内容限制")])]),t._v(" "),a("p",[t._v("对于部分输入，可以限定不能包含特殊字符或者仅能输入数字等。")]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v("其他安全措施")])]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("HTTP-only Cookie")]),t._v(": 禁止 JavaScript 读取某些敏感 Cookie，攻击者完成 XSS 注入后也无法窃取此 Cookie")]),t._v(" "),a("li",[a("strong",[t._v("验证码")]),t._v("：防止脚本冒充用户提交危险操作")])])])}),[],!1,null,null,null);s.default=n.exports}}]);