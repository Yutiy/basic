---
title: "å•ä¾‹æ¨¡å¼"
date: 2020-03-26
permalink: "pattern/singleton"
tag:
  - design-pattern
categories:
  - design-pattern
---

å•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§å¸¸ç”¨çš„æ¨¡å¼ï¼Œæœ‰ä¸€äº›å¯¹è±¡æˆ‘ä»¬å¾€å¾€åªéœ€è¦ä¸€ä¸ªï¼Œæ¯”å¦‚å…¨å±€ç¼“å­˜ã€æµè§ˆå™¨ä¸­çš„ window å¯¹è±¡ç­‰ã€‚å•ä¾‹æ¨¡å¼ç”¨äºä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ã€‚

## ç®€å•ç¤ºä¾‹ ğŸŒ°

```js
function Singleton() {}
const singleton = function () {
  let instance;

  return function () {
    if (!instance) {
      return new Singleton();
    }
    return instance;
  };
};

let s1 = Singleton.getInstance();
let s2 = Singleton.getInstance();
console.log(s1 === s2); // true
```

## ä½¿ç”¨ç¤ºä¾‹

ä¸€ä¸ªå•ä¸€çš„å¯¹è±¡ã€‚å¦‚å¼¹çª—ï¼Œæ— è®ºç‚¹å‡»å¤šå°‘æ¬¡ï¼Œåªåˆ›å»ºä¸€æ¬¡å¼¹çª—ã€‚

```js
// åˆ›å»ºå¼¹çª—
const createLoginLayer = function() {
  const div = document.createElement('div');
  div.innerHTML = 'ç™»å½•';
  div.style.display = 'none';
  document.body.appendChild(div);
  return div
}

// ä½¿ç”¨å•ä¾‹æ¨¡å¼
const getSingle = function(fn) {
  const result;
  return function() {
    return result || result = fn.apply(this, arguments)
  }
}

// ä½¿ç”¨
const createSingleLoginLayer = getSingle(createLoginLayer)
document.getElementById('loginBtn').onclick = function() {
  createSingleLoginLayer()
}
```

## åº”ç”¨åœºæ™¯

- éœ€è¦é¢‘ç¹å®ä¾‹åŒ–ç„¶åé”€æ¯çš„å¯¹è±¡ã€‚
- åˆ›å»ºå¯¹è±¡æ—¶è€—æ—¶è¿‡å¤šæˆ–è€—èµ„æºè¿‡å¤šï¼Œä½†åˆç»å¸¸ç”¨åˆ°çš„å¯¹è±¡ã€‚
- ç³»ç»Ÿåªéœ€è¦ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œå¦‚ç³»ç»Ÿè¦æ±‚æä¾›ä¸€ä¸ªå”¯ä¸€çš„åºåˆ—å·ç”Ÿæˆå™¨æˆ–èµ„æºç®¡ç†å™¨ï¼Œæˆ–è€…éœ€è¦è€ƒè™‘èµ„æºæ¶ˆè€—å¤ªå¤§è€Œåªå…è®¸åˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€‚
